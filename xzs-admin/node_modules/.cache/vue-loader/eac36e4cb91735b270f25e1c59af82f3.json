{"remainingRequest":"/Users/cynthiachen/project/graduation_design/xzs/xzs-mysql/source/vue/xzs-admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/cynthiachen/project/graduation_design/xzs/xzs-mysql/source/vue/xzs-admin/src/views/task/edit.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/cynthiachen/project/graduation_design/xzs/xzs-mysql/source/vue/xzs-admin/src/views/task/edit.vue","mtime":1622550123768},{"path":"/Users/cynthiachen/project/graduation_design/xzs/xzs-mysql/source/vue/xzs-admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cynthiachen/project/graduation_design/xzs/xzs-mysql/source/vue/xzs-admin/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/cynthiachen/project/graduation_design/xzs/xzs-mysql/source/vue/xzs-admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cynthiachen/project/graduation_design/xzs/xzs-mysql/source/vue/xzs-admin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB0YXNrQXBpIGZyb20gJ0AvYXBpL3Rhc2snCmltcG9ydCBleGFtUGFwZXJBcGkgZnJvbSAnQC9hcGkvZXhhbVBhcGVyJwppbXBvcnQgUGFnaW5hdGlvbiBmcm9tICdAL2NvbXBvbmVudHMvUGFnaW5hdGlvbicKaW1wb3J0IHsgbWFwR2V0dGVycywgbWFwU3RhdGUsIG1hcEFjdGlvbnMgfSBmcm9tICd2dWV4JwoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsgUGFnaW5hdGlvbiB9LAogIGRhdGEgKCkgewogICAgcmV0dXJuIHsKICAgICAgZm9ybTogewogICAgICAgIGlkOiBudWxsLAogICAgICAgIGdyYWRlTGV2ZWw6IG51bGwsCiAgICAgICAgdGl0bGU6ICcnLAogICAgICAgIHBhcGVySXRlbXM6IFtdCiAgICAgIH0sCiAgICAgIGZvcm1Mb2FkaW5nOiBmYWxzZSwKICAgICAgcGFwZXJQYWdlOiB7CiAgICAgICAgc3ViamVjdEZpbHRlcjogbnVsbCwKICAgICAgICBtdWx0aXBsZVNlbGVjdGlvbjogW10sCiAgICAgICAgc2hvd0RpYWxvZzogZmFsc2UsCiAgICAgICAgcXVlcnlQYXJhbTogewogICAgICAgICAgc3ViamVjdElkOiBudWxsLAogICAgICAgICAgbGV2ZWw6IG51bGwsCiAgICAgICAgICBwYXBlclR5cGU6IDYsCiAgICAgICAgICBwYWdlSW5kZXg6IDEsCiAgICAgICAgICBwYWdlU2l6ZTogNQogICAgICAgIH0sCiAgICAgICAgbGlzdExvYWRpbmc6IHRydWUsCiAgICAgICAgdGFibGVEYXRhOiBbXSwKICAgICAgICB0b3RhbDogMAogICAgICB9LAogICAgICBydWxlczogewogICAgICAgIGdyYWRlTGV2ZWw6IFt7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn6K+36L6T5YWl5bm057qnJywgdHJpZ2dlcjogJ2NoYW5nZScgfV0sCiAgICAgICAgdGl0bGU6IFt7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn6K+36L6T5YWl5Lu75Yqh5qCH6aKYJywgdHJpZ2dlcjogJ2JsdXInIH1dCiAgICAgIH0KICAgIH0KICB9LAogIGNyZWF0ZWQgKCkgewogICAgbGV0IF90aGlzID0gdGhpcwogICAgdGhpcy5pbml0U3ViamVjdChmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLnBhcGVyUGFnZS5zdWJqZWN0RmlsdGVyID0gX3RoaXMuc3ViamVjdHMKICAgIH0pCgogICAgbGV0IGlkID0gdGhpcy4kcm91dGUucXVlcnkuaWQKICAgIGlmIChpZCAmJiBwYXJzZUludChpZCkgIT09IDApIHsKICAgICAgX3RoaXMuZm9ybUxvYWRpbmcgPSB0cnVlCiAgICAgIHRhc2tBcGkuc2VsZWN0KGlkKS50aGVuKHJlID0+IHsKICAgICAgICBfdGhpcy5mb3JtID0gcmUucmVzcG9uc2UKICAgICAgICBfdGhpcy5mb3JtTG9hZGluZyA9IGZhbHNlCiAgICAgIH0pCiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBhZGRQYXBlciAoKSB7CiAgICAgIHRoaXMucGFwZXJQYWdlLnF1ZXJ5UGFyYW0ubGV2ZWwgPSB0aGlzLmZvcm0uZ3JhZGVMZXZlbAogICAgICB0aGlzLnBhcGVyUGFnZS5zaG93RGlhbG9nID0gdHJ1ZQogICAgICB0aGlzLnNlYXJjaCgpCiAgICB9LAogICAgY29uZmlybVBhcGVyU2VsZWN0ICgpIHsKICAgICAgdGhpcy5wYXBlclBhZ2UubXVsdGlwbGVTZWxlY3Rpb24uZm9yRWFjaChlcCA9PiB0aGlzLmZvcm0ucGFwZXJJdGVtcy5wdXNoKGVwKSkKICAgICAgdGhpcy5wYXBlclBhZ2Uuc2hvd0RpYWxvZyA9IGZhbHNlCiAgICB9LAogICAgc2VhcmNoICgpIHsKICAgICAgdGhpcy5wYXBlclBhZ2Uuc2hvd0RpYWxvZyA9IHRydWUKICAgICAgdGhpcy5saXN0TG9hZGluZyA9IHRydWUKICAgICAgZXhhbVBhcGVyQXBpLnRhc2tFeGFtUGFnZSh0aGlzLnBhcGVyUGFnZS5xdWVyeVBhcmFtKS50aGVuKGRhdGEgPT4gewogICAgICAgIGNvbnN0IHJlID0gZGF0YS5yZXNwb25zZQogICAgICAgIHRoaXMucGFwZXJQYWdlLnRhYmxlRGF0YSA9IHJlLmxpc3QKICAgICAgICB0aGlzLnBhcGVyUGFnZS50b3RhbCA9IHJlLnRvdGFsCiAgICAgICAgdGhpcy5wYXBlclBhZ2UucXVlcnlQYXJhbS5wYWdlSW5kZXggPSByZS5wYWdlTnVtCiAgICAgICAgdGhpcy5wYXBlclBhZ2UubGlzdExvYWRpbmcgPSBmYWxzZQogICAgICB9KQogICAgfSwKICAgIGhhbmRsZVNlbGVjdGlvbkNoYW5nZSAodmFsKSB7CiAgICAgIHRoaXMucGFwZXJQYWdlLm11bHRpcGxlU2VsZWN0aW9uID0gdmFsCiAgICB9LAogICAgZXhhbVBhcGVyU3VibWl0Rm9ybSAoKSB7CiAgICAgIHRoaXMucGFwZXJQYWdlLnF1ZXJ5UGFyYW0ucGFnZUluZGV4ID0gMQogICAgICB0aGlzLnNlYXJjaCgpCiAgICB9LAogICAgbGV2ZWxDaGFuZ2UgKCkgewogICAgICB0aGlzLnBhcGVyUGFnZS5xdWVyeVBhcmFtLnN1YmplY3RJZCA9IG51bGwKICAgICAgdGhpcy5wYXBlclBhZ2Uuc3ViamVjdEZpbHRlciA9IHRoaXMuc3ViamVjdHMuZmlsdGVyKGRhdGEgPT4gZGF0YS5sZXZlbCA9PT0gdGhpcy5mb3JtLmdyYWRlTGV2ZWwpCiAgICB9LAogICAgcmVtb3ZlUGFwZXIgKHJvdykgewogICAgICB0aGlzLmZvcm0ucGFwZXJJdGVtcy5mb3JFYWNoKChpdGVtLCBpbmRleCwgYXJyKSA9PiB7CiAgICAgICAgaWYgKGl0ZW0uaWQgPT09IHJvdy5pZCkgewogICAgICAgICAgYXJyLnNwbGljZShpbmRleCwgMSkKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgc3VibWl0Rm9ybSAoKSB7CiAgICAgIGxldCBfdGhpcyA9IHRoaXMKICAgICAgdGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKCh2YWxpZCkgPT4gewogICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgdGhpcy5mb3JtTG9hZGluZyA9IHRydWUKICAgICAgICAgIHRhc2tBcGkuZWRpdCh0aGlzLmZvcm0pLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgICAgIGlmIChkYXRhLmNvZGUgPT09IDEpIHsKICAgICAgICAgICAgICBfdGhpcy4kbWVzc2FnZS5zdWNjZXNzKGRhdGEubWVzc2FnZSkKICAgICAgICAgICAgICBfdGhpcy5kZWxDdXJyZW50VmlldyhfdGhpcykudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICBfdGhpcy4kcm91dGVyLnB1c2goJy90YXNrL2xpc3QnKQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXMuJG1lc3NhZ2UuZXJyb3IoZGF0YS5tZXNzYWdlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF90aGlzLmZvcm1Mb2FkaW5nID0gZmFsc2UKICAgICAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgICAgICBfdGhpcy5mb3JtTG9hZGluZyA9IGZhbHNlCiAgICAgICAgICB9KQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgcmVzZXRGb3JtICgpIHsKICAgICAgbGV0IGxhc3RJZCA9IHRoaXMuZm9ybS5pZAogICAgICB0aGlzLiRyZWZzWydmb3JtJ10ucmVzZXRGaWVsZHMoKQogICAgICB0aGlzLmZvcm0gPSB7CiAgICAgICAgaWQ6IG51bGwsCiAgICAgICAgZ3JhZGVMZXZlbDogbnVsbCwKICAgICAgICB0aXRsZTogJycsCiAgICAgICAgcGFwZXJJdGVtczogW10KICAgICAgfQogICAgICB0aGlzLmZvcm0uaWQgPSBsYXN0SWQKICAgIH0sCiAgICBzdWJqZWN0Rm9ybWF0dGVyIChyb3csIGNvbHVtbiwgY2VsbFZhbHVlLCBpbmRleCkgewogICAgICByZXR1cm4gdGhpcy5zdWJqZWN0RW51bUZvcm1hdChjZWxsVmFsdWUpCiAgICB9LAogICAgLi4ubWFwQWN0aW9ucygnZXhhbScsIHsgaW5pdFN1YmplY3Q6ICdpbml0U3ViamVjdCcgfSksCiAgICAuLi5tYXBBY3Rpb25zKCd0YWdzVmlldycsIHsgZGVsQ3VycmVudFZpZXc6ICdkZWxDdXJyZW50VmlldycgfSkKICB9LAogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBHZXR0ZXJzKCdlbnVtSXRlbScsIFsnZW51bUZvcm1hdCddKSwKICAgIC4uLm1hcFN0YXRlKCdlbnVtSXRlbScsIHsKICAgICAgcXVlc3Rpb25UeXBlRW51bTogc3RhdGUgPT4gc3RhdGUuZXhhbS5xdWVzdGlvbi50eXBlRW51bSwKICAgICAgbGV2ZWxFbnVtOiBzdGF0ZSA9PiBzdGF0ZS51c2VyLmxldmVsRW51bQogICAgfSksCiAgICAuLi5tYXBHZXR0ZXJzKCdleGFtJywgWydzdWJqZWN0RW51bUZvcm1hdCddKSwKICAgIC4uLm1hcFN0YXRlKCdleGFtJywgeyBzdWJqZWN0czogc3RhdGUgPT4gc3RhdGUuc3ViamVjdHMgfSkKICB9Cn0K"},{"version":3,"sources":["edit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8DA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"edit.vue","sourceRoot":"src/views/task","sourcesContent":["<template>\n  <div class=\"app-container\">\n\n    <el-form :model=\"form\" ref=\"form\" label-width=\"100px\" v-loading=\"formLoading\" :rules=\"rules\">\n      <el-form-item label=\"年级：\" prop=\"gradeLevel\"  required>\n        <el-select v-model=\"form.gradeLevel\" placeholder=\"年级\" @change=\"levelChange\" >\n          <el-option v-for=\"item in levelEnum\" :key=\"item.key\" :value=\"item.key\" :label=\"item.value\"></el-option>\n        </el-select>\n      </el-form-item>\n      <el-form-item label=\"标题：\"  prop=\"title\" required>\n        <el-input v-model=\"form.title\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"试卷：\"  required>\n        <el-table  :data=\"form.paperItems\" border fit highlight-current-row style=\"width: 100%\">\n          <el-table-column prop=\"subjectId\" label=\"学科\" :formatter=\"subjectFormatter\" width=\"120px\" />\n          <el-table-column prop=\"name\" label=\"名称\"  />\n          <el-table-column prop=\"createTime\" label=\"创建时间\" width=\"160px\"/>\n          <el-table-column  label=\"操作\" align=\"center\"  width=\"160px\">\n            <template slot-scope=\"{row}\">\n              <el-button size=\"mini\" type=\"danger\" @click=\"removePaper(row)\" class=\"link-left\">删除</el-button>\n            </template>\n          </el-table-column>\n        </el-table>\n      </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"submitForm\">提交</el-button>\n        <el-button @click=\"resetForm\">重置</el-button>\n        <el-button type=\"success\" @click=\"addPaper\">添加试卷</el-button>\n      </el-form-item>\n    </el-form>\n\n    <el-dialog :visible.sync=\"paperPage.showDialog\" width=\"70%\">\n      <el-form :model=\"paperPage.queryParam\" ref=\"queryForm\" :inline=\"true\">\n        <el-form-item label=\"学科：\" >\n          <el-select v-model=\"paperPage.queryParam.subjectId\"  clearable>\n            <el-option v-for=\"item in paperPage.subjectFilter\" :key=\"item.id\" :value=\"item.id\" :label=\"item.name+' ( '+item.levelName+' )'\"></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"examPaperSubmitForm\">查询</el-button>\n        </el-form-item>\n      </el-form>\n      <el-table v-loading=\"paperPage.listLoading\" :data=\"paperPage.tableData\"\n                @selection-change=\"handleSelectionChange\" border fit highlight-current-row style=\"width: 100%\">\n        <el-table-column type=\"selection\" width=\"35\"></el-table-column>\n        <el-table-column prop=\"id\" label=\"Id\" width=\"90px\"/>\n        <el-table-column prop=\"subjectId\" label=\"学科\" :formatter=\"subjectFormatter\" width=\"120px\" />\n        <el-table-column prop=\"name\" label=\"名称\"  />\n        <el-table-column prop=\"createTime\" label=\"创建时间\" width=\"160px\"/>\n      </el-table>\n      <pagination v-show=\"paperPage.total>0\" :total=\"paperPage.total\"\n                  :page.sync=\"paperPage.queryParam.pageIndex\" :limit.sync=\"paperPage.queryParam.pageSize\"\n                  @pagination=\"search\"/>\n      <span slot=\"footer\" class=\"dialog-footer\">\n          <el-button @click=\"paperPage.showDialog = false\">取 消</el-button>\n          <el-button type=\"primary\" @click=\"confirmPaperSelect\">确定</el-button>\n     </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport taskApi from '@/api/task'\nimport examPaperApi from '@/api/examPaper'\nimport Pagination from '@/components/Pagination'\nimport { mapGetters, mapState, mapActions } from 'vuex'\n\nexport default {\n  components: { Pagination },\n  data () {\n    return {\n      form: {\n        id: null,\n        gradeLevel: null,\n        title: '',\n        paperItems: []\n      },\n      formLoading: false,\n      paperPage: {\n        subjectFilter: null,\n        multipleSelection: [],\n        showDialog: false,\n        queryParam: {\n          subjectId: null,\n          level: null,\n          paperType: 6,\n          pageIndex: 1,\n          pageSize: 5\n        },\n        listLoading: true,\n        tableData: [],\n        total: 0\n      },\n      rules: {\n        gradeLevel: [{ required: true, message: '请输入年级', trigger: 'change' }],\n        title: [{ required: true, message: '请输入任务标题', trigger: 'blur' }]\n      }\n    }\n  },\n  created () {\n    let _this = this\n    this.initSubject(function () {\n      _this.paperPage.subjectFilter = _this.subjects\n    })\n\n    let id = this.$route.query.id\n    if (id && parseInt(id) !== 0) {\n      _this.formLoading = true\n      taskApi.select(id).then(re => {\n        _this.form = re.response\n        _this.formLoading = false\n      })\n    }\n  },\n  methods: {\n    addPaper () {\n      this.paperPage.queryParam.level = this.form.gradeLevel\n      this.paperPage.showDialog = true\n      this.search()\n    },\n    confirmPaperSelect () {\n      this.paperPage.multipleSelection.forEach(ep => this.form.paperItems.push(ep))\n      this.paperPage.showDialog = false\n    },\n    search () {\n      this.paperPage.showDialog = true\n      this.listLoading = true\n      examPaperApi.taskExamPage(this.paperPage.queryParam).then(data => {\n        const re = data.response\n        this.paperPage.tableData = re.list\n        this.paperPage.total = re.total\n        this.paperPage.queryParam.pageIndex = re.pageNum\n        this.paperPage.listLoading = false\n      })\n    },\n    handleSelectionChange (val) {\n      this.paperPage.multipleSelection = val\n    },\n    examPaperSubmitForm () {\n      this.paperPage.queryParam.pageIndex = 1\n      this.search()\n    },\n    levelChange () {\n      this.paperPage.queryParam.subjectId = null\n      this.paperPage.subjectFilter = this.subjects.filter(data => data.level === this.form.gradeLevel)\n    },\n    removePaper (row) {\n      this.form.paperItems.forEach((item, index, arr) => {\n        if (item.id === row.id) {\n          arr.splice(index, 1)\n        }\n      })\n    },\n    submitForm () {\n      let _this = this\n      this.$refs.form.validate((valid) => {\n        if (valid) {\n          this.formLoading = true\n          taskApi.edit(this.form).then(data => {\n            if (data.code === 1) {\n              _this.$message.success(data.message)\n              _this.delCurrentView(_this).then(() => {\n                _this.$router.push('/task/list')\n              })\n            } else {\n              _this.$message.error(data.message)\n            }\n            _this.formLoading = false\n          }).catch(e => {\n            _this.formLoading = false\n          })\n        } else {\n          return false\n        }\n      })\n    },\n    resetForm () {\n      let lastId = this.form.id\n      this.$refs['form'].resetFields()\n      this.form = {\n        id: null,\n        gradeLevel: null,\n        title: '',\n        paperItems: []\n      }\n      this.form.id = lastId\n    },\n    subjectFormatter (row, column, cellValue, index) {\n      return this.subjectEnumFormat(cellValue)\n    },\n    ...mapActions('exam', { initSubject: 'initSubject' }),\n    ...mapActions('tagsView', { delCurrentView: 'delCurrentView' })\n  },\n  computed: {\n    ...mapGetters('enumItem', ['enumFormat']),\n    ...mapState('enumItem', {\n      questionTypeEnum: state => state.exam.question.typeEnum,\n      levelEnum: state => state.user.levelEnum\n    }),\n    ...mapGetters('exam', ['subjectEnumFormat']),\n    ...mapState('exam', { subjects: state => state.subjects })\n  }\n}\n</script>\n"]}]}